<!DOCTYPE html>
<html lang="es-VE">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="author" content="Salomon Trujillo" />
    <meta name="description" content="Este es el juego Batalla Naval"/>
    <meta name="keywords" content="Batalla Naval, juego, taller"/>
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" href="https://static3.depositphotos.com/1007664/237/v/450/depositphotos_2376836-stock-illustration-battle-ship.jpg" type="image/png" sizes="16x16 32x32 64x64">
    <link rel="stylesheet" href="../estilos/style.css">
    <script src="../scripts/script.js" defer></script>
    <title>Batalla Naval | Juego con cuatro</title>
</head>
<body>
  <div class="principal-jugar-cuatro">
    <header>
        <hgroup>
            <h1>Batalla Naval</h1>
            <h2>¡Sé un ganador!</h2>
        </hgroup> 
        <nav class="opciones-navegación"> 
            <a href="usuario.html">REGISTRO</a>
            <a href="reglas.html">REGLAS</a>
        </nav>
    </header>
    
    <main>
        <section class="informacion-partida">
            <h3>TIEMPO: 00:00</h3>
            <h3>PUNTOS: 000</h3>
            <a href="#" aria-label="Rendirse">RENDIRSE</a>
        </section>

        <section class="generar-codigo">
            <div class="crear-partida">
                <button id="create-game" class="server-operation" aria-label="Generar código para el juego">Generar Código</button>
                <input type="text" id="game-id" class="server-operation" placeholder="ID del juego" aria-label="ID del juego"/>
            </div>
            
        </section>

        <section class="tableros">
            <div class="tablero-propio" id="tablero-propio-solo-3" aria-label="Tablero propio"></div>
            <div class="tablero-enemigo" id="tablero-enemigo-solo-5" aria-label="Tablero enemigo 1"></div>
            <div class="tablero-enemigo" id="tablero-enemigo-solo-6" aria-label="Tablero enemigo 2"></div>
            <div class="tablero-enemigo" id="tablero-enemigo-solo-7" aria-label="Tablero enemigo 3"></div>
        </section>
        <div class="contenedor-principal">
          <!-- Contenedor para los barcos -->
          <div class="contenedor-barcos">
              <div class="barcos"></div> <!-- Contenedor donde se crearán los barcos arrastrables -->
          </div>

        <section class="power-ups">
            <a href="#" aria-label="Ver power-ups disponibles">Power-ups disponibles</a>
            <a href="power-ups.html" aria-label="Ir a la página de Power-ups">POWER UPS</a>
        </section>

        <section class="conexion-ws">
            <div id="iniciar-partida">
                <button id="start-game" class="server-operation" type="button" aria-label="Iniciar partida">Jugar</button>
            </div>
            <div class="salir-partida">
                <button id="leave-game" class="server-operation" type="button" aria-label="Abandonar partida">RENDIRSE</button>
            </div>
            <div id="cerrar-conexion">
                <button id="close-connection" class="client-operation" type="button" aria-label="Cerrar la conexión">Cerrar Conexión</button>
            </div>
        </section>
    </main>

    <footer>
        <h3>by: Ing. Salomón Trujillo | Program Web | UCAB</h3>
    </footer>
  </div>



    <script>

        const WEBSOCKET_SCHEME = 'ws';
        const WEBSOCKET_SERVER = 'batalla-naval.deno.dev';
        const WEBSOCKET_PORT = 80;
        const WEBSOCKET_URL = `${WEBSOCKET_SCHEME}://${WEBSOCKET_SERVER}:${WEBSOCKET_PORT}`;
  
        const socket = new WebSocket(WEBSOCKET_URL);
  
        socket.addEventListener('open', () => {
  
          console.log(`%cConectado al servidor en ${WEBSOCKET_URL}`,  'color: #99ff00');
        });
  
        socket.addEventListener('message', (event) => {
  
          const message = JSON.parse(event.data);
  
          console.log('%c<- %cMensaje recibido desde el servidor:', 'color: #99ff00', 'color: inherit', message);
        });
  
        socket.addEventListener('close', () => {
          console.log('%cSe ha cerrado la conexión con el servidor WebSocket', 'color: #ee0000');
  
          const buttons = document.getElementsByClassName('server-operation');
  
          [...buttons].forEach((button) => {
            button.disabled = true;
          });
  
          const closeButton = document.getElementById('close-connection');
          closeButton.parentNode.removeChild(closeButton);
  
        });
  
        //CREAR JUEGO
        document.getElementById('create-game').addEventListener('click', () => {
  
          //const gameId = document.getElementById('game-id').value;
  
          socket.send(JSON.stringify({ type: 'create' }));
         // document.getElementById('id-de-partida').textContent = `ID: ${gameId}`;
        });
  
        //EMPEZAR JUEGO
        document.getElementById('start-game').addEventListener('click', () => {
  
          const gameId = document.getElementById('game-id').value;
  
          socket.send(JSON.stringify({ type: 'start', gameId }));
          console.log('Empezo el juego');
  
        });
  
        //SALIR DEL JUEGO
        document.getElementById('leave-game').addEventListener('click', () => {
          const gameId = document.getElementById('game-id').value;
  
          socket.send(JSON.stringify({ type: 'leave', gameId }));
        });
  
        //CERRAR CONEXION
        document.getElementById('close-connection').addEventListener('click', () => {
  
          const response = confirm('¿Estás seguro de que deseas cerrar la conexión con el servidor de WebSocket?\n\nSi la cierras, no podrás enviar ni recibir más mensajes y, de acuerdo a esta implementación, tendrás que recargar la página.');
  
          if (response) {
            socket.close();
          }
        });
  
  
      </script>
</body>
</html>
<!DOCTYPE html>
<html lang="es-VE">
<head>
    <meta charset="UTF-8"/>
    <!--<meta name="language" content="es-VE"/>-->
    <meta name="viewport" content="width=device-width, initial-scala1.0" />
    <meta name="author" content="Salomon Trujillo" />
    <meta name="description" content="Este es el juego Batalla Naval"/>
    <meta name="keywords" content="Batalla Naval, juego, taller"/>
    <meta name="robots" content="noindex, nofollow" />
    <link rel="icon" href="https://static3.depositphotos.com/1007664/237/v/450/depositphotos_2376836-stock-illustration-battle-ship.jpg" type="imag/png " sizes="16x16 32x32 64x64">
    <link rel="stylesheet" href="../estilos/style.css">
    <script src="../scripts/script.js"></script>
    <title>BatallaNaval | Juego con dos</title>
</head>

<body>
  <div class="principal-jugar-dos">
    <header>
        <hgroup>
            <h1>Batalla Naval</h1>
            <h2>¡Sé un ganador!</h2>
        </hgroup>
        <nav class="opciones-navegación">
            <a href="usuario.html">REGISTRO</a>
            <a href="reglas.html">REGLAS</a>
        </nav>
    </header>

    <main>
        <div class="informacion-partida">
          <h2>Contador de Partida</h2>
          <div id="partida">03:00</div>
            <h3>PUNTOS: 000</h3>
        </div>

        <div class="generar-codigo">
            <div class="crear-partida">
                <button id="crear-partida" class="server-operation">Generar Código</button>
                <input type="text" id="id-partida" class="server-operation" placeholder="ID del juego" />
            </div>
        </div>

        <div class="jugadores">
          <div class="jugador">
              <h2>Jugador 1</h2>
              <div id="jugador1">10</div>
          </div>
          <div class="jugador">
              <h2>Jugador 2</h2>
              <div id="jugador2">10</div>
          </div>
      </div>
      <div id="turno">Turno de: Jugador 1</div>
      <button onclick="iniciarContadores()">Iniciar</button>

        <div class="contenedor-principal">
            <!-- Contenedor para los barcos -->
            <div class="contenedor-barcos">
                <div class="barcos"></div> <!-- Contenedor donde se crearán los barcos arrastrables -->
            </div>

            <!-- Contenedor para los tableros -->
            <div class="tableros">
                <div class="tablero-propio" id="tablero-propio-solo-1"></div>
                <div class="tablero-enemigo" id="tablero-enemigo-solo-1"></div>
            </div>
        </div>

        <div class="powerup">
            <a href="#">Power-ups disponibles</a>
            <a href="power-ups.html">POWER UPS</a>
        </div>

        <div class="conexion-ws">
            <div id="iniciarpartida">
                <button id="iniciar-partida" class="server-operation" type="button">Jugar</button>
            </div>
            <div class="atacar-enemigo">
              <button id="atacar-enemigo" class="server-operation">Atacar</button>
              <input type="text" id="move" class="server-operation" placeholder="Movimiento (p. ej. A1)" />
            </div>
            <div class="salir-partida">
                <button id="dejar-partida" class="server-operation" type="button">RENDIRSE</button>
            </div>
            <div id="cerrar-conexion">
                <button id="cerrar-conexion" class="client-operation" type="button">Cerrar Conexión</button>
            </div>
        </div>
    </main>

    <footer>
        <h3>by: Ing. Salomón Trujillo | Program Web | Ucab</h3>
    </footer>
</div>

<script>
  const WEBSOCKET_SCHEME = 'ws';
  const WEBSOCKET_SERVER = 'batalla-naval.deno.dev';
  const WEBSOCKET_PORT = 80;
  const WEBSOCKET_URL = `${WEBSOCKET_SCHEME}://${WEBSOCKET_SERVER}:${WEBSOCKET_PORT}`;

  const socket = new WebSocket(WEBSOCKET_URL);

  socket.addEventListener('open', () => {
    console.log(`%cConecxion exitosa en ${WEBSOCKET_URL}`,  'color: #99ff00');
  });

  socket.addEventListener('message', (event) => {
    const message = JSON.parse(event.data);
    console.log('%c<- %cMensaje recibido desde el servidor:', 'color: #99ff00', 'color: inherit', message);
  });

  socket.addEventListener('close', () => {
    console.log('%cSe ha cerrado la conexión con el servidor', 'color: #ee0000');

    const buttons = document.getElementsByClassName('server-operation');

    [...buttons].forEach((button) => {
      button.disabled = true;
    });

    const closeButton = document.getElementById('close-connection');
    closeButton.parentNode.removeChild(closeButton);
  });

  //CREAR JUEGO
  document.getElementById('crear-partida').addEventListener('click', () => {
    socket.send(JSON.stringify({ type: 'create' }));
  });

  //EMPEZAR JUEGO
  document.getElementById('iniciar-partida').addEventListener('click', () => {
    const gameId = document.getElementById('id-partida').value;
    socket.send(JSON.stringify({ type: 'start', gameId }));
    console.log('Empezó el juego');
  });

  //ATACAR
  document.getElementById('atacar-enemigo').addEventListener('click', () => {
  
  const gameId = document.getElementById('id-partida').value;
  const move = document.getElementById('move').value;

  socket.send(JSON.stringify({ type: 'move', gameId, move }));
  });

  //SALIR DEL JUEGO
  document.getElementById('dejar-partida').addEventListener('click', () => {
    const gameId = document.getElementById('id-partida').value;
    socket.send(JSON.stringify({ type: 'leave', gameId }));
  });

  //CERRAR CONEXION
  document.getElementById('cerrar-conexion').addEventListener('click', () => {
    const response = confirm('¿Estás seguro de que deseas cerrar la conexión con el servidor de WebSocket?\n\nSi la cierras, no podrás enviar ni recibir más mensajes y, de acuerdo a esta implementación, tendrás que recargar la página.');

    if (response) {
      socket.close();
    }
  });
</script>

</body>
</html>